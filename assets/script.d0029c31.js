const a="https://unpkg.com/@workadventure/scripting-api-extra@1.3.2/dist";class p{constructor(e){this.properties=e!=null?e:[]}get(e){const n=this.properties.filter(t=>t.name===e).map(t=>t.value);if(n.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(n.length!==0)return n[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,n){const t=this.get(e);if(t!==void 0){if(typeof t!==n)throw new Error('Expected property "'+e+'" to have type "'+n+'"');return t}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,n){const t=this.get(e);if(t===void 0)throw new Error('Property "'+e+'" is missing');if(typeof t!==n)throw new Error('Expected property "'+e+'" to have type "'+n+'"');return t}getType(e){const n=this.properties.filter(t=>t.name===e).map(t=>t.type);if(n.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(n.length!==0)return n[0]}}function u(o,e,n){for(const t of o)t.type==="group"?u(t.layers,e+t.name+"/",n):(t.name=e+t.name,n.set(t.name,t))}async function f(){const o=await WA.room.getTiledMap(),e=new Map;return u(o.layers,"",e),e}function c(o){console.log("Configure exit : "+o);const e=o?"#"+o.join():"";console.log(a+"/configuration.html"+e),WA.nav.openCoWebSite(a+"/configuration.html"+e)}function l(o,e,n){let t;const r=n.getString("openConfigAdminTag");let i=!0;r&&!WA.player.tags.includes(r)&&(i=!1),WA.room.onEnterLayer(e).subscribe(()=>{const s=n.getString("openConfigTrigger");var g;i&&(s&&s==="onaction"?(t&&t.remove(),g=n.getString("openConfigTriggerMessage"),g||(g="Press SPACE or touch here to configure"),t=WA.ui.displayActionMessage({message:g,callback:()=>c(o)})):c(o))}),WA.room.onLeaveLayer(e).subscribe(()=>{t&&t.remove(),WA.nav.closeCoWebSite()})}WA.onInit().then(async()=>{WA.player.tags.includes("editor")&&["exitEastConfig","exitSouthConfig"].forEach(WA.room.showLayer);const o=await WA.room.getTiledMap(),e=await f(),n=o.layers.find(t=>t.name==="configuration");if(n){const t=new p(n.properties).getString("tag");console.log(t),t&&WA.player.tags.includes(t)&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(a+"/configuration.html",!0)});for(const r of e.values()){const i=new p(r.properties),s=i.getString("openConfig");s&&r.type==="tilelayer"&&l(s.split(","),r.name,i)}}});
